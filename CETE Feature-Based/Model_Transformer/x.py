#from Pytorch.Model_Transformer.imap_qa import calc_map1,calc_mrr1
from Pytorch.Model_Transformer.imap_qa_test import calc_map1,calc_mrr1

def read_data(filename):
    with open(filename, 'r') as datafile:
        res = []
        for line in datafile:
            line = line.strip().split('\t')
            lines = []
            length = len(line)
            if (length < 3):
                lines.append(line[0])
                lines.append("question")
                lines.append(line[1])
            else:
                lines.append(line[0])
                lines.append(line[1])
                lines.append(line[2])

            res.append([lines[0], lines[1], float(lines[2])])

    return res

if __name__=='__main__':
    filename='../data/Trec_test_not_aligned.txt'
    t_f = read_data(filename=filename)
    print(t_f)
    f=open("../data/my_pred_result.txt","r")
    r=[]
    for i in f:
        x=float(i[1:len(i)-2])
        r.append(x)
    #print(r.size)
    res1=calc_map1('../data/Trec_test_not_aligned.txt',r)
    res2 = calc_mrr1('../data/Trec_test_not_aligned.txt', r)
    print(res1)
    print(res2)

    '''
    harvest = np.array([[0.294921875, 0.21875, 0.228515625, 0.255859375, 0.09765625, 0.173828125, 0.435546875, 0.4140625, 0.33984375, 0.306640625, 0.435546875, 0.3984375],
    [0.251953125, 0.1640625, 0.146484375, 0.208984375, 0.02734375, 0.123046875, 0.384765625, 0.37890625, 0.29296875, 0.369140625, 0.474609375, 0.41015625],
    [0.38671875, 0.212890625, 0.19140625, 0.23046875, 0.076171875, 0.13671875, 0.33203125, 0.380859375, 0.310546875, 0.32421875, 0.3828125, 0.376953125],
    [0.29296875, 0.251953125, 0.24609375, 0.2890625, 0.095703125, 0.17578125, 0.375, 0.341796875, 0.330078125, 0.36328125, 0.421875, 0.400390625],
    [0.3248561918735504, 0.2834951877593994, 0.28172990679740906, 0.32452136278152466, 0.16661545634269714, 0.23046875, 0.35596179962158203, 0.3496513366699219, 0.32236331701278687, 0.36395910382270813, 0.3637075424194336, 0.3341403007507324]])*2
    '''

    '''
    harvest = np.array([[0.22265625, 0.23828125, 0.19140625, 0.22265625, 0.119140625, 0.12890625, 0.365234375, 0.298828125, 0.333984375, 0.3359375, 0.390625, 0.25],
    [0.26953125, 0.26171875, 0.18359375, 0.2421875, 0.126953125, 0.1640625, 0.318359375, 0.287109375, 0.341796875, 0.35546875, 0.3984375, 0.26953125],
    [0.4375, 0.29296875, 0.24609375, 0.24609375, 0.18244454264640808, 0.18359375, 0.279296875, 0.287109375, 0.291015625, 0.2421875, 0.3125, 0.28515625],
    [0.318359375, 0.310546875, 0.255859375, 0.291015625, 0.17578125, 0.177734375, 0.32421875, 0.2578125, 0.33203125, 0.251953125, 0.267578125, 0.271484375],
    [0.390625, 0.34375, 0.3125, 0.27734375, 0.216796875, 0.234375, 0.291015625, 0.271484375, 0.326171875, 0.25390625, 0.25, 0.26171875]
    ])*2
    '''

    '''

    [0.294921875, 0.21875, 0.228515625, 0.255859375, 0.09765625, 0.173828125, 0.435546875, 0.4140625, 0.33984375, 0.306640625, 0.435546875, 0.3984375],
    [0.251953125, 0.1640625, 0.146484375, 0.208984375, 0.02734375, 0.123046875, 0.384765625, 0.37890625, 0.29296875, 0.369140625, 0.474609375, 0.41015625],
    [0.38671875, 0.212890625, 0.19140625, 0.23046875, 0.076171875, 0.13671875, 0.33203125, 0.380859375, 0.310546875, 0.32421875, 0.3828125, 0.376953125],
    [0.29296875, 0.251953125, 0.24609375, 0.2890625, 0.095703125, 0.17578125, 0.375, 0.341796875, 0.330078125, 0.36328125, 0.421875, 0.400390625],
    [0.3248561918735504, 0.2834951877593994, 0.28172990679740906, 0.32452136278152466, 0.16661545634269714, 0.23046875, 0.35596179962158203, 0.3496513366699219, 0.32236331701278687, 0.36395910382270813, 0.3637075424194336, 0.3341403007507324]

    '''